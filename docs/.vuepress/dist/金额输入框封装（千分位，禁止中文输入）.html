<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>金额输入框封装（千分位，禁止中文输入） | 前端笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="前端笔记">
    
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.cccb21c6.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.c67c5da6.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/2.eeb24f79.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/47.2492cfa6.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.5337bfd3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.43439a8b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.ef0ccc82.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.d45ceac6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.86f3b39f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.4ebef001.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.91e74913.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.e7522585.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.fd918a9f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.3658db2e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.a30074c1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.534b25a2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.06685893.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.902495c0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.9f672a51.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.841a83df.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.baf3e08e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.9aa320b3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.aaac7303.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.0c79d8a4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.4be1bc6c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.99505e93.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.419ffd3b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.2c8603dc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.9dce2642.js"><link rel="prefetch" href="/vuepress-blog/assets/js/34.4cca7072.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.cac668e7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/36.f9699987.js"><link rel="prefetch" href="/vuepress-blog/assets/js/37.34fe6535.js"><link rel="prefetch" href="/vuepress-blog/assets/js/38.527afdac.js"><link rel="prefetch" href="/vuepress-blog/assets/js/39.743d4c06.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.f876ad59.js"><link rel="prefetch" href="/vuepress-blog/assets/js/40.ab97d810.js"><link rel="prefetch" href="/vuepress-blog/assets/js/41.7cfc49c1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/42.0194af80.js"><link rel="prefetch" href="/vuepress-blog/assets/js/43.024609eb.js"><link rel="prefetch" href="/vuepress-blog/assets/js/44.fedadfda.js"><link rel="prefetch" href="/vuepress-blog/assets/js/45.5361ccb6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/46.7c24424d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/48.47dc0462.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.18c5236f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.e86df8f9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.2c3ac2da.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.1a5c7481.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.a56e1dc1.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.cccb21c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>列表</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/常用的正则表达式大全.html" class="sidebar-link">常用的正则表达式大全</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>局部自定义指令v-money</p> <div class="language- extra-class"><pre class="language-text"><code>使用： v-money可输入两位小数   v-money.int整数
&lt;el-input v-money.int v-model=&quot;inputVal&quot;&gt;&lt;/el-input&gt;
directives: {
        money: {
            bind(el, binding) {
                el = el.children[0];获取到el-input输入框dom
                let type = binding.modifiers //自定义指令参数
                function format(n) {
                    if (!n) return n;
                    if (Number(n) == 0 || n == '.') return '';//只输入0、.清空输入框
                    let str = n.split('.');
                    let re = /\d{1,3}(?=(\d{3})+$)/g;
                    let n1 = str[0].replace(re, &quot;$&amp;,&quot;);//千分位
                    if (type.int) return n1;//若不需要补小数点、补零
                    if (str.length &gt; 1 &amp;&amp; str[1]) {
                    	//已输入一位小数，补一位0
                        str[1].length === 1 ? str[1] = str[1] + '0' : str[1]
                    }
                    return str.length &gt; 1 &amp;&amp; str[1] ? `${n1}.${str[1]}` : `${n1}.00`;
                }
                //去除千分位中的‘，’
                function unformat(num) {
                    if (!num) return num;
                    num = num.toString();
                    num = num.replace(/,/gi, '');
                    let str = num.split('.');
                    if (type.int) return num;
                    //有小数为00，聚焦自动去除
                    if (str.length &gt; 1) {
                        str[1] == '00' ? num = str[0] : num
                    } else {
                        num = num
                    }
                    return num;
                }
                el.addEventListener('focus', function (e) {
                    let inputVal = e.target.value || '';
                    e.target.value = unformat(inputVal)
                    //解决ie重新聚焦输入框，光标在最前方bug
                    el.setSelectionRange(e.target.value.length, e.target.value.length);
                })
                el.addEventListener('blur', function (e) {
                    e.target.value = format(e.target.value);
                })
                //当用户使用拼音输入法开始输入汉字时，compositionstart事件就会被触发，输入过程中不会再触发
                el.addEventListener('compositionstart', function (e) {
                    e.target.isNeedPrevent = true;

                })
                //当文本段落的组成完成或取消时, compositionend 事件将被触发。
                el.addEventListener('compositionend', function (e) {
                    e.target.isNeedPrevent = false;
                })
                el.addEventListener('input', function (e) {
                //setTimeout+compositionstart+compositionend解决输入法为中文时，每输入拼音都会触发事件、				且会删除已经输入的正确内容的bug
                    setTimeout(() =&gt; {
                        if (e.target.isNeedPrevent) return;
                        let reg
                        if (type.int) {
                            reg = /[^\d]/g
                        } else {
                            reg = /[^\d.]/g
                        }
                        let str = e.target.value
                        str = str.replace(reg, '')
                        e.target.value = str
                    })
                })
                el.addEventListener('keypress', function (e) {
                    if (e.target.value == '' &amp;&amp; e.key === '.') {//首位禁止输入.
                        e.preventDefault()
                    }
                    //注：这里的正则reg必须在本function内部声明。直接写在bind下会导致每第二次输入错误字符可					以正常输入
                    let reg
                    if (type.int) {
                        reg = /[^\d]/g
                    } else {
                        reg = /[^\d.]/g
                    }
                    if (reg.test(e.key)) {
                        e.preventDefault()
                    }
                    if (e.target.value.indexOf('.') &gt; -1) {
                        let str = e.target.value.split('.')
                        //如果已经存在小数点，禁止再次输入
                        //已经存在两位小数，禁止继续输入
                        if (e.key === '.' || str[1].length &gt;= 2) {
                            e.preventDefault()
                        }
                    }
                })
            }
        }
    }
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.c67c5da6.js" defer></script><script src="/vuepress-blog/assets/js/2.eeb24f79.js" defer></script><script src="/vuepress-blog/assets/js/47.2492cfa6.js" defer></script>
  </body>
</html>
