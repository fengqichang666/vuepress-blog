<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue3笔记 | 前端笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="前端笔记">
    
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.cccb21c6.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.a8afb511.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/2.eeb24f79.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/25.c49860b4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.0350c3ea.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.281663f5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.2996a2fc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.faeb9608.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.8cd28623.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.a9b5fe70.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.213186e7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.027a8d5a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.fd918a9f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.0f99e775.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.0656efd0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.aea31464.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.ab1f9882.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.db531b80.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.3555df7d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.baf3e08e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.b324c032.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.7e162c1d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.6f7bdf63.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.4be1bc6c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.c765e19b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.419ffd3b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.d08d44bc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.9dce2642.js"><link rel="prefetch" href="/vuepress-blog/assets/js/34.b7de1fa5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.8a30637e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/36.2a978ba1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/37.3aa90734.js"><link rel="prefetch" href="/vuepress-blog/assets/js/38.527afdac.js"><link rel="prefetch" href="/vuepress-blog/assets/js/39.423b2829.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.f876ad59.js"><link rel="prefetch" href="/vuepress-blog/assets/js/40.ce9c0aa7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/41.aabbf61a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/42.f1762c6b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/43.0fe53c8a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/44.fedadfda.js"><link rel="prefetch" href="/vuepress-blog/assets/js/45.b4b7ae18.js"><link rel="prefetch" href="/vuepress-blog/assets/js/46.7c24424d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/47.2492cfa6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/48.47dc0462.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.18c5236f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.e86df8f9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.7659b6fc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.0f8ff2a8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.47aeda78.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.cccb21c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>列表</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/commonJS与es6模块化.html" class="sidebar-link">exports、module.exports和export、export default</a></li><li><a href="/vuepress-blog/eslint使用、报错部分快速修复.html" class="sidebar-link">vue-cli中eslint检验指定文件/夹、报错部分快速修复</a></li><li><a href="/vuepress-blog/git-HEAD-与HEAD-的区别.html" class="sidebar-link">git HEAD~与HEAD^的区别</a></li><li><a href="/vuepress-blog/git-merge-no-ff-与-ff-和-squash的区别.html" class="sidebar-link">git merge --no-ff 与--ff 和--squash的区别</a></li><li><a href="/vuepress-blog/Git凭据管理的三种方式-https.html" class="sidebar-link">Git凭据管理的三种方式(https)</a></li><li><a href="/vuepress-blog/git操作指令.html" class="sidebar-link">git命令总结</a></li><li><a href="/vuepress-blog/JS工具函数.html" class="sidebar-link">工具函数</a></li><li><a href="/vuepress-blog/js执行机制.html" class="sidebar-link">js执行机制</a></li><li><a href="/vuepress-blog/nodejs-websocket.html" class="sidebar-link">nodejs-websocket</a></li><li><a href="/vuepress-blog/pinia.html" class="sidebar-link">pinia</a></li><li><a href="/vuepress-blog/Proxy和Object-defineProperty.html" class="sidebar-link">Proxy和Object.defineProperty</a></li><li><a href="/vuepress-blog/react笔记.html" class="sidebar-link">react笔记</a></li><li><a href="/vuepress-blog/router4笔记.html" class="sidebar-link">router4笔记</a></li><li><a href="/vuepress-blog/uniapp笔记.html" class="sidebar-link">uniapp笔记</a></li><li><a href="/vuepress-blog/vue-elementui-表单检验中发送接口进行校验.html" class="sidebar-link">vue+elementui 表单检验中发送接口进行校验</a></li><li><a href="/vuepress-blog/vue3+elementplus+ts+pinia踩坑记录.html" class="sidebar-link">vue3+elementplus+ts+pinia踩坑记录</a></li><li><a href="/vuepress-blog/vue3笔记.html" class="active sidebar-link">vue3笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#vue3-新特性介绍" class="sidebar-link">Vue3 新特性介绍</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#vue3-优化vdom" class="sidebar-link">Vue3 优化Vdom</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#vue3-fragment" class="sidebar-link">Vue3 Fragment</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#ref全家桶" class="sidebar-link">Ref全家桶</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#reactive全家桶" class="sidebar-link">Reactive全家桶</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#to系列全家桶" class="sidebar-link">to系列全家桶</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#computed用法" class="sidebar-link">computed用法</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#watch侦听器" class="sidebar-link">watch侦听器</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#watcheffect高级侦听器" class="sidebar-link">watchEffect高级侦听器</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#组件的生命周期" class="sidebar-link">组件的生命周期</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#vnode-hooks" class="sidebar-link">VNode hooks</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#父子组件传参" class="sidebar-link">父子组件传参</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#依赖注入provide-inject" class="sidebar-link">依赖注入Provide / Inject</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#兄弟组件传参和bus" class="sidebar-link">兄弟组件传参和Bus</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#全局组件-局部组件-递归组件" class="sidebar-link">全局组件，局部组件，递归组件</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#动态组件" class="sidebar-link">动态组件</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#插槽slot" class="sidebar-link">插槽slot</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#异步组件-代码分包-suspense" class="sidebar-link">异步组件&amp;代码分包&amp;suspense</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#teleport传送组件" class="sidebar-link">Teleport传送组件</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#keep-alive缓存组件" class="sidebar-link">keep-alive缓存组件</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#transition动画组件" class="sidebar-link">transition动画组件</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#transition-group过度列表" class="sidebar-link">transition-group过度列表</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#深入v-model" class="sidebar-link">深入v-model</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#自定义指令directive-属于破坏性更新" class="sidebar-link">自定义指令directive(属于破坏性更新)</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#自定义hooks" class="sidebar-link">自定义Hooks</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#vue3定义全局函数和变量" class="sidebar-link">Vue3定义全局函数和变量</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#编写vue3插件" class="sidebar-link">编写Vue3插件</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#scoped和样式-穿透" class="sidebar-link">Scoped和样式 穿透</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#css-style完整新特性" class="sidebar-link">css Style完整新特性</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#mitt" class="sidebar-link">Mitt</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#环境变量" class="sidebar-link">环境变量</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/vue3笔记.html#proxy跨域" class="sidebar-link">Proxy跨域</a></li></ul></li><li><a href="/vuepress-blog/vuex.html" class="sidebar-link">vuex</a></li><li><a href="/vuepress-blog/Vue中extend-mixins-extends以及Vue-use的install和Vue-nextTick.html" class="sidebar-link">Vue中extend,mixins,extends以及Vue.use的install和Vue.nextTick</a></li><li><a href="/vuepress-blog/vue响应式原理及收集依赖.html" class="sidebar-link">vue响应式原理、依赖收集</a></li><li><a href="/vuepress-blog/vue对数组的处理.html" class="sidebar-link">vue对数组的处理</a></li><li><a href="/vuepress-blog/vue知识点记录.html" class="sidebar-link">vue知识点记录</a></li><li><a href="/vuepress-blog/vue第三方组件css修改.html" class="sidebar-link">vue第三方组件css修改</a></li><li><a href="/vuepress-blog/vue组件通信.html" class="sidebar-link">vue组件通信</a></li><li><a href="/vuepress-blog/webpack笔记.html" class="sidebar-link">webpack笔记</a></li><li><a href="/vuepress-blog/前端学习资料.html" class="sidebar-link">前端学习资料</a></li><li><a href="/vuepress-blog/前端性能优化面试题.html" class="sidebar-link">前端性能优化面试题总结</a></li><li><a href="/vuepress-blog/前端鉴权cookie、session、token、jwt、单点登录.html" class="sidebar-link">前端鉴权cookie、session、token、jwt、单点登录</a></li><li><a href="/vuepress-blog/单点登录SSO.html" class="sidebar-link">单点登录SSO</a></li><li><a href="/vuepress-blog/原型链.html" class="sidebar-link">原型链</a></li><li><a href="/vuepress-blog/导航聚合网站.html" class="sidebar-link">网站、论坛合集</a></li><li><a href="/vuepress-blog/常用的正则表达式大全.html" class="sidebar-link">常用的正则表达式大全</a></li><li><a href="/vuepress-blog/开发中容易遇到的问题.html" class="sidebar-link">开发中容易遇到的问题</a></li><li><a href="/vuepress-blog/数据类型判断.html" class="sidebar-link">数据类型判断</a></li><li><a href="/vuepress-blog/样式清单整理.html" class="sidebar-link">样式清单整理</a></li><li><a href="/vuepress-blog/组件库开发.html" class="sidebar-link">组件库开发</a></li><li><a href="/vuepress-blog/网站、论坛合集.html" class="sidebar-link">网站、论坛合集</a></li><li><a href="/vuepress-blog/虚拟DOM与DIFF算法.html" class="sidebar-link">虚拟DOM与DIFF算法</a></li><li><a href="/vuepress-blog/详解mixins混入使用.html" class="sidebar-link">详解mixins混入使用</a></li><li><a href="/vuepress-blog/金额输入框封装（千分位，禁止中文输入）.html" class="sidebar-link">金额输入框封装（千分位，禁止中文输入）</a></li><li><a href="/vuepress-blog/键盘事件keydown，keypress，keyup.html" class="sidebar-link">键盘事件keydown，keypress，keyup</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="vue3-新特性介绍"><a href="#vue3-新特性介绍" class="header-anchor">#</a> Vue3 新特性介绍</h2> <h3 id="重写双向绑定"><a href="#重写双向绑定" class="header-anchor">#</a> 重写双向绑定</h3> <div class="language- extra-class"><pre class="language-text"><code>vue2
基于Object.defineProperty()实现

vue3 基于Proxy
proxy与Object.defineProperty(obj, prop, desc)方式相比有以下优势：

//丢掉麻烦的备份数据
//省去for in 循环
//可以监听数组变化
//代码更简化
//可以监听动态新增的属性；
//可以监听删除的属性 ；
//可以监听数组的索引和 length 属性；
let proxyObj = new Proxy(obj,{
    get : function (target,prop) {
        return prop in target ? target[prop] : 0
    },
    set : function (target,prop,value) {
        target[prop] = 888;
    }
})
</code></pre></div><h2 id="vue3-优化vdom"><a href="#vue3-优化vdom" class="header-anchor">#</a> Vue3 优化Vdom</h2> <p><strong>在Vue2中,每次更新diff,都是全量对比,Vue3则只对比带有标记的,这样大大减少了非动态内容的对比消耗</strong></p> <h3 id="patch-flag-优化静态树"><a href="#patch-flag-优化静态树" class="header-anchor">#</a> patch flag 优化静态树</h3> <div class="language- extra-class"><pre class="language-text"><code>&lt;span&gt;Hello world!&lt;/span&gt;
&lt;span&gt;Hello world!&lt;/span&gt;
&lt;span&gt;Hello world!&lt;/span&gt;
&lt;span&gt;Hello world!&lt;/span&gt;
&lt;span&gt;{{msg}}&lt;/span&gt;
&lt;span&gt;Hello world!&lt;/span&gt;
&lt;span&gt;Hello world! &lt;/span&gt;
</code></pre></div><p><code>Vue3</code> 编译后的 <code>Vdom</code> 是这个样子的</p> <div class="language- extra-class"><pre class="language-text"><code>export function render(_ctx，_cache，$props，$setup，$data，$options){return (_openBlock(),_createBlock(_Fragment,null，[
_createvNode( &quot;span&quot;, null,&quot;Hello world ! &quot;),
_createvNode( &quot;span&quot;,null，&quot;Hello world! &quot;),
_createvNode( &quot;span&quot;，null，&quot;Hello world! &quot;),
_createvNode( &quot;span&quot;, null，&quot;Hello world! &quot;),
_createVNode(&quot;span&quot;, null，_toDisplaystring(_ctx.msg)，1/* TEXT */)，
_createvNode( &quot;span&quot;, null，&quot;Hello world! &quot;),
_createvNode( &quot;span&quot;, null，&quot;Hello world! &quot;)]，64/*STABLE_FRAGMENT */))
</code></pre></div><p>新增了 patch flag 标记</p> <div class="language- extra-class"><pre class="language-text"><code>TEXT = 1 // 动态文本节点
CLASS=1&lt;&lt;1,1 // 2//动态class
STYLE=1&lt;&lt;2，// 4 //动态style
PROPS=1&lt;&lt;3,// 8 //动态属性，但不包含类名和样式
FULLPR0PS=1&lt;&lt;4,// 16 //具有动态key属性，当key改变时，需要进行完整的diff比较。
HYDRATE_ EVENTS = 1 &lt;&lt; 5，// 32 //带有监听事件的节点
STABLE FRAGMENT = 1 &lt;&lt; 6, // 64 //一个不会改变子节点顺序的fragment
KEYED_ FRAGMENT = 1 &lt;&lt; 7, // 128 //带有key属性的fragment 或部分子字节有key
UNKEYED FRAGMENT = 1&lt;&lt; 8, // 256 //子节点没有key 的fragment
NEED PATCH = 1 &lt;&lt; 9, // 512 //一个节点只会进行非props比较
DYNAMIC_SLOTS = 1 &lt;&lt; 10 // 1024 // 动态slot
HOISTED = -1 // 静态节点
BALL = -2
</code></pre></div><p>我们发现创建动态 dom 元素的时候，Vdom 除了模拟出来了它的基本信息之外，还给它加了一个标记： 1 /* TEXT */</p> <p>这个标记就叫做 patch flag（补丁标记）</p> <p>patch flag 的强大之处在于，当你的 diff 算法走到 _createBlock 函数的时候，会忽略所有的静态节点，只对有标记的动态节点进行对比，而且在多层的嵌套下依然有效。</p> <p>尽管 JavaScript 做 Vdom 的对比已经非常的快，但是 patch flag 的出现还是让 Vue3 的 Vdom 的性能得到了很大的提升，尤其是在针对大组件的时候。</p> <h2 id="vue3-fragment"><a href="#vue3-fragment" class="header-anchor">#</a> Vue3 Fragment</h2> <p>vue3 允许我们支持多个根节点(vue将为我们创建一个虚拟的Fragment节点)、同时支持render JSX 写法</p> <h2 id="ref全家桶"><a href="#ref全家桶" class="header-anchor">#</a> Ref全家桶</h2> <h3 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h3> <p>绑定普通的数据类型，如果用ref去绑定对象 或者 数组 等复杂的数据类型，源码里面其实也是 去调用reactive</p> <p>接受一个内部值并返回一个<a href="https://so.csdn.net/so/search?q=%E5%93%8D%E5%BA%94%E5%BC%8F&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">响应式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>且可变的 ref 对象。ref 对象仅有一个 <code>.value</code> property，指向该内部值。</p> <h3 id="isref"><a href="#isref" class="header-anchor">#</a> isRef</h3> <p>判断是不是一个ref对象</p> <div class="language- extra-class"><pre class="language-text"><code>import { ref, Ref,isRef } from 'vue'
let message: Ref&lt;string | number&gt; = ref(&quot;我是message&quot;)
let notRef:number = 123
const changeMsg = () =&gt; {
  message.value = &quot;change msg&quot;

  console.log(isRef(message)); //true
  console.log(isRef(notRef)); //false
  
}
</code></pre></div><h3 id="shallowref、triggerref"><a href="#shallowref、triggerref" class="header-anchor">#</a> shallowRef、triggerRef</h3> <p>shallowRef()存在的意义：将最终的结果输出到视图，节省一些不必要的输出。</p> <p><strong>shallowRef是浅层响应式数据，即：修改.value值时会更新视图。而修改具体属性值时，不会更新视图。</strong></p> <p>triggerRef  强制更新页面DOM</p> <div class="language- extra-class"><pre class="language-text"><code>1、shallowRef() 函数是浅层响应，只有对value整体修改，才能更新到视图层。
2、对属性值的修改是可以的，只是不更新到视图层。
3、对属性值修改之后，我们可以通过triggerRef()函数手动更新到视图。

// 定义shallowRef变量
const state = shallowRef({ count: 1 })

// 整体修改值（即.value），其template内的视图也会更新！
state.value = { count: 2 }

// 修改属性值时，其template内的视图不会更新！但并不代表其值没有被修改，仅仅是视图没更新
state.value.count = 2

// 此时我们可以用triggerRef函数手动更新视图
triggerRef(state)
</code></pre></div><h3 id="customref"><a href="#customref" class="header-anchor">#</a> customRef</h3> <p>创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。</p> <p>customRef 是个工厂函数要求我们自定义的 <code>ref</code> 中返回一个 <code>customRef</code>，而 <code>customRef</code> 也要返回一个对象，并且实现 get 和 set ，适合去做防抖之类的</p> <p>customRef的两个参数分别是用于追踪的 track 与用于触发响应的 trigger</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
 
  &lt;div ref=&quot;div&quot;&gt;小满Ref&lt;/div&gt;
  &lt;hr&gt;
  &lt;div&gt;
    {{ name }}
  &lt;/div&gt;
  &lt;hr&gt;
  &lt;button @click=&quot;change&quot;&gt;修改 customRef&lt;/button&gt;
 
&lt;/template&gt;
 
&lt;script setup lang='ts'&gt;
import { ref, reactive, onMounted, shallowRef, customRef } from 'vue'
 
function myRef&lt;T = any&gt;(value: T) {
  let timer:any;
  return customRef((track, trigger) =&gt; {
    return {
      get() {
        track()
        return value
      },
      set(newVal) {
        clearTimeout(timer)
        timer =  setTimeout(() =&gt; {
          console.log('触发了set')
          value = newVal
          trigger()
        },500)
      }
    }
  })
}
 
const name = myRef&lt;string&gt;('小满')
 
const change = () =&gt; {
  name.value = '大满'
}
 
&lt;/script&gt;
&lt;style scoped&gt;
&lt;/style&gt;
</code></pre></div><h2 id="reactive全家桶"><a href="#reactive全家桶" class="header-anchor">#</a> Reactive全家桶</h2> <h3 id="reactive"><a href="#reactive" class="header-anchor">#</a> <code>reactive</code></h3> <p><strong>reactive 源码约束了我们的类型，用来绑定复杂的数据类型 例如 对象 数组</strong></p> <p>使用reactive 去修改值无须.value</p> <p>reactive 基础用法</p> <div class="language- extra-class"><pre class="language-text"><code>import { reactive } from 'vue'
let person = reactive({
   name:&quot;小满&quot;
})
person.name = &quot;大满&quot;
</code></pre></div><p>数组异步赋值问题</p> <p>这样赋值页面是不会变化的因为会脱离响应式</p> <div class="language- extra-class"><pre class="language-text"><code>let person = reactive&lt;number[]&gt;([])
setTimeout(() =&gt; {
  person = [1, 2, 3]
  console.log(person);
  
},1000)
</code></pre></div><p>解决方案1  使用push</p> <div class="language- extra-class"><pre class="language-text"><code>import { reactive } from 'vue'
let person = reactive&lt;number[]&gt;([])
setTimeout(() =&gt; {
  const arr = [1, 2, 3]
  person.push(...arr)
  console.log(person);
  
},1000)
</code></pre></div><p>方案2  包裹一层对象</p> <div class="language- extra-class"><pre class="language-text"><code>type Person = {
  list?:Array&lt;number&gt;
}
let person = reactive&lt;Person&gt;({
   list:[]
})
setTimeout(() =&gt; {
  const arr = [1, 2, 3]
  person.list = arr;
  console.log(person);
},1000)
</code></pre></div><h3 id="readonly"><a href="#readonly" class="header-anchor">#</a> readonly</h3> <p>取得一个对象（反应性或普通）或ref并返回一个只读代理。访问的任何嵌套属性也将是只读的。
传入普通对象等返回只读代理。
传入普通数值或字符串不能变成只读，例如 readonly(‘abc’)</p> <p>可结合Provide/inject 使用</p> <div class="language- extra-class"><pre class="language-text"><code>const original = reactive({ count: 0 })

const copy = readonly(original)

watchEffect(() =&gt; {
  // 反应性跟踪
  console.log(copy.count)
})

// 改变 original 会触发观察copy的watcher执行其函数回调
original.count++

// 改变 copy 将会失败并且在控制台返回一个警告
copy.count++ // warning!

</code></pre></div><h3 id="shallowreactive"><a href="#shallowreactive" class="header-anchor">#</a> shallowReactive</h3> <p>只能对浅层的数据（对象第一层） 如果是深层的数据只会改变值 不会改变视图</p> <h2 id="to系列全家桶"><a href="#to系列全家桶" class="header-anchor">#</a> to系列全家桶</h2> <h3 id="toref"><a href="#toref" class="header-anchor">#</a> toRef</h3> <ul><li>toRef是将对象中的某个值转化为响应式数据 toRef(obj,key)</li> <li>注意点：就是 toRef 修改的值，只能修改原始对象为 响应式对象，toRe如果原始对象是非响应式的就不会更新视图 数据是会变的</li></ul> <h3 id="torefs"><a href="#torefs" class="header-anchor">#</a> toRefs</h3> <p>可以帮我们批量创建ref对象主要是方便我们解构使用</p> <p>对对象解构时，解构出来的值为非响应式数据，但使用 toRefs 定义后 这些被解构出来的值 为响应式数据</p> <div class="language- extra-class"><pre class="language-text"><code>import { reactive, toRefs } from 'vue'
const obj = reactive({
   foo: 1,
   bar: 1
})
 
let { foo, bar } = toRefs(obj)
 
foo.value++
console.log(foo, bar);
</code></pre></div><h3 id="toraw"><a href="#toraw" class="header-anchor">#</a> toRaw</h3> <p>将响应式对象转化为普通对象</p> <div class="language- extra-class"><pre class="language-text"><code>import { reactive, toRaw } from 'vue'
const obj = reactive({
   foo: 1,
   bar: 1
})
const state = toRaw(obj)
// 响应式对象转化为普通对象
const change = () =&gt; {
   console.log(obj, state);
}
</code></pre></div><h2 id="computed用法"><a href="#computed用法" class="header-anchor">#</a> computed用法</h2> <p><a href="https://so.csdn.net/so/search?q=%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">计算属性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>就是当依赖的属性的值发生变化的时候，才会触发他的更改，如果依赖的值，不发生变化的时候，使用的是缓存中的属性值。</p> <p>1 函数形式</p> <div class="language- extra-class"><pre class="language-text"><code>let price = ref(0)//$0 
let m = computed&lt;string&gt;(()=&gt;{
   return `$` + price.value
})
price.value = 500
</code></pre></div><p>2 对象形式</p> <div class="language- extra-class"><pre class="language-text"><code>let price = ref&lt;number | string&gt;(1)//$0
let mul = computed({
   get: () =&gt; {
      return price.value
   },
   set: (value) =&gt; {
      price.value = 'set' + value
   }
})
const changeMul = ()=&gt; {
    mul.value = '***'
}
</code></pre></div><h2 id="watch侦听器"><a href="#watch侦听器" class="header-anchor">#</a> watch侦听器</h2> <p><code>watch</code> 需要侦听特定的数据源，并在单独的回调函数中执行副作用</p> <p>watch第一个参数监听源</p> <p>watch第二个参数回调函数cb（newVal,oldVal）</p> <p>watch第三个参数一个options配置项是一个对象{</p> <p>​	<a href="https://so.csdn.net/so/search?q=immediate&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">immediate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:true //是否立即调用一次</p> <p>​	deep:true //是否开启<a href="https://so.csdn.net/so/search?q=%E6%B7%B1%E5%BA%A6%E7%9B%91%E5%90%AC&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">深度监听<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>}</p> <p>监听Ref</p> <div class="language- extra-class"><pre class="language-text"><code>let message = ref({
    nav:{
        bar:{
            name:&quot;&quot;
        }
    }
})
 
 
watch(message, (newVal, oldVal) =&gt; {
    console.log('新的值----', newVal);
    console.log('旧的值----', oldVal);
},{
    immediate:true,
    deep:true
})
</code></pre></div><p>监听多个ref 注意变成数组</p> <div class="language- extra-class"><pre class="language-text"><code>let message = ref('')
let message2 = ref('')
 
watch([message,message2], (newVal, oldVal) =&gt; {
    console.log('新的值----', newVal);
    console.log('旧的值----', oldVal);
})
</code></pre></div><p>监听Reactive</p> <p>使用reactive监听深层对象开启和不开启deep 效果一样</p> <div class="language- extra-class"><pre class="language-text"><code>import { ref, watch ,reactive} from 'vue'
 
let message = reactive({
    nav:{
        bar:{
            name:&quot;&quot;
        }
    }
})
 
 
watch(message, (newVal, oldVal) =&gt; {
    console.log('新的值----', newVal);
    console.log('旧的值----', oldVal);
})
</code></pre></div><p>监听reactive 单一值</p> <div class="language- extra-class"><pre class="language-text"><code>let message = reactive({
    name:&quot;&quot;,
    name2:&quot;&quot;
})
watch(()=&gt;message.name, (newVal, oldVal) =&gt; {
    console.log('新的值----', newVal);
    console.log('旧的值----', oldVal);
})
</code></pre></div><h2 id="watcheffect高级侦听器"><a href="#watcheffect高级侦听器" class="header-anchor">#</a> watchEffect高级侦听器</h2> <p>立即执行传入的一个函数，同时<a href="https://so.csdn.net/so/search?q=%E5%93%8D%E5%BA%94%E5%BC%8F&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">响应式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>追踪其依赖，并在其依赖变更时重新运行该函数。</p> <p>watchEffect 接收2个参数 ，并且有返回一个 StopHandle 函数用来停止侦听。
1、第一个参数：（必传）
effect 函数，收集依赖，并且组件初始化时立即执行一次;
并且 effect 函数可以接受一个 onInvalidate 函数参数，该参数执行并传入一个 callback ，每次监听回调执行前都会执行该 callback。
2、第二个参数对象（非必传）： flush 、 onTrack 、 onTrigger;</p> <div class="language- extra-class"><pre class="language-text"><code>let count = ref(0)
let Cc = computed(()=&gt; count.value * 2)
let obj = reactive({
  data:123,
  inObj:{d1:0}
})
 
const stop = watchEffect((onInvalidate) =&gt; {
  //! 立即执行传入的回调函数，同时响应式追踪其所有依赖，并在依赖变更时重新运行该回调函数。
  console.log(Cc.value); // 注意，如果依赖是 ref 和 computed 对象，必须要.value，否则并不会视为依赖
  console.log(count.value);
  console.log(obj.data); // 同理，reactive数据也只会侦听触发了get的property(属性)
  //! 注意首次执行并不会执行onInvalidate ，第二次开始才会！
  onInvalidate(()=&gt;{
    //! 在回调触发前会调用该函数，并且stop()停止侦听的时候也会触发一次！
    console.log('watchEffect的onInvalidate');
  })
 
},{
  flush:'pre', // flush?: 'pre' | 'post' | 'sync' // 默认：'pre'
  
  //! 跟踪之前会触发该函数，收集了多少个依赖就触发多少次！返回对应依赖信息
  onTrack(e){console.log(e.target,'onTrack触发')}, 
 
  //! 跟他名字一样依赖更改就触发执行，而且是同步的！没有所谓的缓冲回调
  onTrigger(e){console.log(e.target,'onTrigger触发')} 
})
setTimeout(() =&gt; {
  stop() // 停止侦听 则调用该返回值即可 
}, 1000*5);
</code></pre></div><h3 id="清除副作用-oninvalidate"><a href="#清除副作用-oninvalidate" class="header-anchor">#</a> 清除副作用 oninvalidate</h3> <p>在触发监听之前会调用一个函数可以处理你的逻辑例如<a href="https://so.csdn.net/so/search?q=%E9%98%B2%E6%8A%96&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">防抖<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li>在回调触发前会调用该函数</li> <li>侦听器被停止 (如果在 <code>setup()</code> 或生命周期钩子函数中使用了 <code>watchEffect</code>，在组件卸载时会自动停止侦听。)</li></ol> <div class="language- extra-class"><pre class="language-text"><code>let message = ref&lt;string&gt;('')
let message2 = ref&lt;string&gt;('')
 watchEffect((oninvalidate) =&gt; {
    //console.log('message', message.value);
    oninvalidate(()=&gt;{
        
    })
    console.log('message2', message2.value);
})
</code></pre></div><h3 id="副作用刷新时机-flush-一般使用post"><a href="#副作用刷新时机-flush-一般使用post" class="header-anchor">#</a> 副作用刷新时机 flush 一般使用post</h3> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">pre</th> <th style="text-align:left;">sync</th> <th style="text-align:left;">post</th></tr></thead> <tbody><tr><td style="text-align:left;">更新时机</td> <td style="text-align:left;">组件<strong>更新前</strong>执行</td> <td style="text-align:left;">强制效果始终同步触发</td> <td style="text-align:left;">组件<strong>更新后</strong>执行</td></tr></tbody></table> <p><strong>停止跟踪</strong></p> <p>watchEffect 返回一个函数 调用之后将停止更新</p> <p>生命周期钩子函数中使用了 <code>watchEffect</code>，在组件卸载时也会自动停止侦听。</p> <div class="language- extra-class"><pre class="language-text"><code>const stop =  watchEffect((oninvalidate) =&gt; {
    //console.log('message', message.value);
    oninvalidate(()=&gt;{
 
    })
    console.log('message2', message2.value);
},{
    flush:&quot;post&quot;,
    onTrigger () {
 
    }
})
// 停止跟踪
stop()
</code></pre></div><h2 id="组件的生命周期"><a href="#组件的生命周期" class="header-anchor">#</a> 组件的生命周期</h2> <table><thead><tr><th style="text-align:left;">选项式 API</th> <th style="text-align:left;">Hook inside <code>setup</code></th></tr></thead> <tbody><tr><td style="text-align:left;"><code>beforeCreate</code></td> <td style="text-align:left;">Not needed*</td></tr> <tr><td style="text-align:left;"><code>created</code></td> <td style="text-align:left;">Not needed*</td></tr> <tr><td style="text-align:left;"><code>beforeMount</code></td> <td style="text-align:left;"><code>onBeforeMount</code></td></tr> <tr><td style="text-align:left;"><code>mounted</code></td> <td style="text-align:left;"><code>onMounted</code></td></tr> <tr><td style="text-align:left;"><code>beforeUpdate</code></td> <td style="text-align:left;"><code>onBeforeUpdate</code></td></tr> <tr><td style="text-align:left;"><code>updated</code></td> <td style="text-align:left;"><code>onUpdated</code></td></tr> <tr><td style="text-align:left;"><code>beforeUnmount</code></td> <td style="text-align:left;"><code>onBeforeUnmount</code></td></tr> <tr><td style="text-align:left;"><code>unmounted</code></td> <td style="text-align:left;"><code>onUnmounted</code></td></tr> <tr><td style="text-align:left;"><code>errorCaptured</code></td> <td style="text-align:left;"><code>onErrorCaptured</code></td></tr> <tr><td style="text-align:left;"><code>renderTracked</code></td> <td style="text-align:left;"><code>onRenderTracked</code></td></tr> <tr><td style="text-align:left;"><code>renderTriggered</code></td> <td style="text-align:left;"><code>onRenderTriggered</code></td></tr> <tr><td style="text-align:left;"><code>activated</code></td> <td style="text-align:left;"><code>onActivated</code></td></tr> <tr><td style="text-align:left;"><code>deactivated</code></td> <td style="text-align:left;"><code>onDeactivated</code></td></tr></tbody></table> <p>1  <code>onRenderTracked</code> 直译过来就是状态跟踪，他会跟踪页面上所有的方法跟变量，也就是我们<code>return</code>返回的属性与方法，它都会进行跟踪。当页面有<code>update</code>时，会生成一个<code>event</code>对象。我们可以通过这个<code>event</code>对象查看程序的问题所在。</p> <p>2  <code>onRenderTriggered</code>直译过来是状态触发，它不会跟踪每一个值，而是给你变化值的信息，并且新值和旧值都会给你明确的展示出来。</p> <div class="language- extra-class"><pre class="language-text"><code>新值newValue和旧值oldValue都会给你明确的展示出来。主要的属性介绍
key 哪个变量发生了变化
newValue 更新后变量的值
oldValue 更新前变量的值
target 目前页面中的响应变量和函数
</code></pre></div><p><strong>activated,deactivated</strong></p> <p>activated,deactivated这两个生命周期函数一定是要在使用了keep-alive组件后才会有的，否则则不存在当引入keep-alive的时候，页面第一次进入，钩子的触发顺序created-&gt; mounted-&gt; activated，退出时触发deactivated。当再次进入（前进或者后退）时，只触发activated。
组件每次进去执行的方法放在 activated 中， activated 中的不管是否需要缓存多会执行。</p> <h2 id="vnode-hooks"><a href="#vnode-hooks" class="header-anchor">#</a> VNode hooks</h2> <p>在每个组件或HTML标签上，我们可以使用一些特殊的（文档没写的）钩子作为事件监听器。这些钩子有：</p> <ul><li><p>onVnodeBeforeMount</p></li> <li><p>onVnodeMounted</p></li> <li><p>onVnodeBeforeUpdate</p></li> <li><p>onVnodeUpdated</p></li> <li><p>onVnodeBeforeUnmount</p></li> <li><p>onVnodeUnmounted</p> <p>在组件上使用<code>onVnodeMounted</code>，当需要在组件挂载时执行一些代码，或者在更新时使用<code>onVnodeUpdated</code>进行调试，可以确定的是所有这些钩子都能在某些情况下派上用场。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;script setup&gt;
import { ref } from 'vue'

const count = ref(0)

function onMyComponentMounted() {}

function divThatDisplaysCountWasUpdated() {}
&lt;/script&gt;

&lt;template&gt;
  &lt;MyComponent @vnodeMounted=&quot;onMyComponentMounted&quot; /&gt;
  &lt;div @vnodeUpdated=&quot;divThatDisplaysCountWasUpdated&quot;&gt;{{ count }}&lt;/div&gt;
&lt;/template&gt;
</code></pre></div><p>需要注意的是，这些钩子向回调函数传递一些参数。除了<code>onVnodeBeforeUpdate</code>和<code>onVnodeUpdated</code>传递两个参数，即当前的<code>VNode</code>和之前的<code>VNode</code>，其它只传递一个参数，即当前的<code>VNode</code></p></li></ul> <h2 id="父子组件传参"><a href="#父子组件传参" class="header-anchor">#</a> 父子组件传参</h2> <h3 id="defineprops"><a href="#defineprops" class="header-anchor">#</a> <a href="https://so.csdn.net/so/search?q=defineProps&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">defineProps <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>子组件接受值</p> <div class="language- extra-class"><pre class="language-text"><code>父组件
&lt;Menu :data=&quot;data&quot;  title=&quot;我是标题&quot;&gt;&lt;/Menu&gt;
子组件 ts可以使用传递字面量类型的纯类型语法做为参数
defineProps&lt;{
    title:string,
    data:number[]
}&gt;()
// withDefaults是个函数也是无须引入开箱即用接受一个props函数第二个参数是一个对象设置默认值
type Props = {
    title?: string,
    data?: number[]
}
withDefaults(defineProps&lt;Props&gt;(), {
    title: &quot;张三&quot;,
    data: () =&gt; [1, 2, 3]
})

不是TS
defineProps({
    title:{
        default:&quot;&quot;,
        type:string
    },
    data:Array
})
</code></pre></div><h3 id="defineemits"><a href="#defineemits" class="header-anchor">#</a> defineEmits</h3> <p>子组件给父组件传参 通过defineEmits派发一个事件</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
    &lt;div class=&quot;menu&quot;&gt;
        &lt;button @click=&quot;clickTap&quot;&gt;派发给父组件&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;
 
&lt;script setup lang=&quot;ts&quot;&gt;
import { reactive } from 'vue'
const list = reactive&lt;number[]&gt;([4, 5, 6])
 
const emit = defineEmits(['on-click'])
 
//如果用了ts可以这样
// const emit = defineEmits&lt;{
//     (e: &quot;on-click&quot;, name: string): void
// }&gt;()
const clickTap = () =&gt; {
    emit('on-click', list)
}
 
&lt;/script&gt;
</code></pre></div><h3 id="defineexpose"><a href="#defineexpose" class="header-anchor">#</a> defineExpose</h3> <p>子组件暴露给父组件内部属性   从父组件获取子组件实例通过ref</p> <div class="language- extra-class"><pre class="language-text"><code> &lt;Menu ref=&quot;menus&quot;&gt;&lt;/Menu&gt;
//这样获取是有代码提示的
 const menus = ref&lt;InstanceType&lt;typeof menus&gt;&gt;()
</code></pre></div><p>然后打印menus.value 发现没有任何属性</p> <p>这时候父组件想要读到子组件的属性可以通过 defineExpose暴露</p> <div class="language- extra-class"><pre class="language-text"><code>const list = reactive&lt;number[]&gt;([4, 5, 6])
 
defineExpose({
    list
})
</code></pre></div><h2 id="依赖注入provide-inject"><a href="#依赖注入provide-inject" class="header-anchor">#</a> 依赖注入Provide / Inject</h2> <p>provide 可以在祖先组件中指定我们想要<strong>提供</strong>给后代组件的数据或方法，而在任何后代组件中，我们都可以使用 inject 来接收 provide <strong>提供</strong>的数据或方法。</p> <p>父组件传递数据</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>我是App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>A</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>A</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> provide<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">'./components/A.vue'</span>
<span class="token keyword">let</span> flag <span class="token operator">=</span> ref<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.App</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>子组件接受</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">background-color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        我是B
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>change<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>change falg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ flag }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> inject<span class="token punctuation">,</span> Ref<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
 
<span class="token keyword">const</span> flag <span class="token operator">=</span> inject<span class="token operator">&lt;</span>Ref<span class="token operator">&lt;</span>number<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">,</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
<span class="token keyword">const</span> <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    flag<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果传递普通的值 是不具有响应式的 需要通过ref reactive 添加响应式</p> <p>使用场景</p> <p>当父组件有很多数据需要分发给其子代组件的时候， 就可以使用provide和inject。</p> <h2 id="兄弟组件传参和bus"><a href="#兄弟组件传参和bus" class="header-anchor">#</a> 兄弟组件传参和Bus</h2> <h3 id="借助父组件传参"><a href="#借助父组件传参" class="header-anchor">#</a> 借助父组件传参</h3> <p>A 组件派发事件通过App.vue 接受A组件派发的事件然后在Props 传给B组件 也是可以实现的</p> <p>缺点就是比较麻烦 ，无法直接通信，只能充当桥梁</p> <h3 id="event-bus"><a href="#event-bus" class="header-anchor">#</a> Event Bus</h3> <p>可以使用$emit 传递 $on监听 emit传递过来的事件</p> <p>简易版</p> <div class="language-vue extra-class"><pre class="language-vue"><code> 
type BusClass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> = {
    emit: (name: T) =&gt; void
    on: (name: T, callback: Function) =&gt; void
}
type BusParams = string | number | symbol 
type List = {
    [key: BusParams]: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Function</span><span class="token punctuation">&gt;</span></span>
}
class Bus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span> <span class="token attr-name">extends</span> <span class="token attr-name">BusParams</span><span class="token punctuation">&gt;</span></span> implements BusClass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> {
    list: List
    constructor() {
        this.list = {}
    }
    emit(name: T, ...args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span>) {
        let eventName: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Function</span><span class="token punctuation">&gt;</span></span> = this.list[name]
        eventName.forEach(ev =&gt; {
            ev.apply(this, args)
        })
    }
    on(name: T, callback: Function) {
        let fn: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Function</span><span class="token punctuation">&gt;</span></span> = this.list[name] || [];
        fn.push(callback)
        this.list[name] = fn
    }
}
 
export default new Bus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span>()
</code></pre></div><p>然后挂载到Vue config 全局就可以使用</p> <h2 id="全局组件-局部组件-递归组件"><a href="#全局组件-局部组件-递归组件" class="header-anchor">#</a> 全局组件，局部组件，递归组件</h2> <h3 id="配置全局组件"><a href="#配置全局组件" class="header-anchor">#</a> 配置全局组件</h3> <p>在main.ts 引入我们的组件跟随在createApp(App) 后面 切记不能放到mount 后面这是一个链式调用用</p> <p>调用 component 第一个参数组件名称 第二个参数组件实例</p> <div class="language- extra-class"><pre class="language-text"><code>import { createApp } from 'vue'
import App from './App.vue'
import './assets/css/reset/index.less'
import Card from './components/Card/index.vue'
 
 
createApp(App).component('Card',Card).mount('#app')
</code></pre></div><p>直接在其他vue页面 立即使用即可 无需引入</p> <h3 id="批量注册全局组件"><a href="#批量注册全局组件" class="header-anchor">#</a> 批量注册全局组件</h3> <p>element ui :遍历一下然后通过 app.component 注册</p> <div class="language- extra-class"><pre class="language-text"><code>import * as ElementPlusIconVue from '@element-plus/icons-vue'
const app = created(App)
for(const [key,component] of Object.entries(ElementPlusIconVue)){
	app.component(key,component)
}
</code></pre></div><h3 id="配置局部组件"><a href="#配置局部组件" class="header-anchor">#</a> 配置局部组件</h3> <p>就是在一个组件内（A） 通过import 去引入别的组件(B) 称之为局部组件</p> <p>应为B组件只能在A组件内使用 所以是局部组件</p> <p>如果C组件想用B组件 就需要C组件也手动import 引入 B 组件</p> <h3 id="配置递归组件"><a href="#配置递归组件" class="header-anchor">#</a> 配置递归组件</h3> <p>子组件增加一个组件名称(为了 递归用 )</p> <p>组件定义名称几种方式</p> <p>1.再增加一个script 通过 export 添加name</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;script lang=&quot;ts&quot;&gt;
export default {
  name:&quot;TreeItem&quot;
}
&lt;/script&gt;
</code></pre></div><p>2.直接使用文件名当组件名</p> <p>3.使用插件 unplugin-vue-define-options</p> <p>​	 ts支持 <code>&quot;types&quot;: [&quot;unplugin-vue-define-options/macros-global&quot;]</code></p> <h2 id="动态组件"><a href="#动态组件" class="header-anchor">#</a> 动态组件</h2> <p>什么是动态组件 就是：让多个组件使用同一个挂载点，并动态切换，这就是动态组件</p> <p>在挂载点使用<a href="https://so.csdn.net/so/search?q=component&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>标签，然后使用<a href="https://so.csdn.net/so/search?q=v-bind&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">v-bind<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:is=”组件”</p> <div class="language- extra-class"><pre class="language-text"><code>  &lt;component :is=&quot;A&quot;&gt;&lt;/component&gt;

import A from './A.vue'
import B from './B.vue'
</code></pre></div><p>通过is 切换 A B 组件</p> <p><em><strong>*注意事项*</strong></em></p> <p><em><strong>*1.在Vue2 的时候is 是通过组件名称切换的 在Vue3 setup 是通过组件实例切换的*</strong></em></p> <p><em><strong>*2.如果你把组件实例放到Reactive Vue会给你一个警告runtime-core.esm-bundler.js:38 [Vue warn]: Vue received a Component which was made a reactive object. This can lead to unnecessary performance overhead, and should be avoided by marking the component with <code>markRaw</code> or using <code>shallowRef</code> instead of <code>ref</code>.
Component that was made reactive:*</strong></em></p> <p><em><strong>*这是因为reactive 会进行proxy 代理 而我们组件代理之后毫无用处 节省性能开销 推荐我们使用shallowRef 或者 markRaw 跳过proxy 代理*</strong></em></p> <p><em><strong>*修改如下*</strong></em></p> <div class="language- extra-class"><pre class="language-text"><code>const tab = reactive&lt;Com[]&gt;([{
    name: &quot;A组件&quot;,
    comName: markRaw(A)
}, {
    name: &quot;B组件&quot;,
    comName: markRaw(B)
}])
</code></pre></div><h2 id="插槽slot"><a href="#插槽slot" class="header-anchor">#</a> 插槽slot</h2> <p>插槽就是子组件中的提供给父组件使用的一个<a href="https://so.csdn.net/so/search?q=%E5%8D%A0%E4%BD%8D%E7%AC%A6&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">占位符<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，用 表示，父组件可以在这个占位符中填充任何模板代码，如 HTML、组件等，填充的内容会替换子组件的标签。</p> <h3 id="匿名插槽"><a href="#匿名插槽" class="header-anchor">#</a> 匿名插槽</h3> <p>1.在子组件放置一个插槽</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
    &lt;div&gt;
       &lt;slot&gt;&lt;/slot&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre></div><p>父组件使用插槽</p> <p>在父组件给这个插槽填充内容</p> <div class="language- extra-class"><pre class="language-text"><code>        &lt;Dialog&gt;
           &lt;template v-slot&gt;
               &lt;div&gt;2132&lt;/div&gt;
           &lt;/template&gt;
        &lt;/Dialog&gt;
</code></pre></div><h3 id="具名插槽"><a href="#具名插槽" class="header-anchor">#</a> <a href="https://so.csdn.net/so/search?q=%E5%85%B7%E5%90%8D%E6%8F%92%E6%A7%BD&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">具名插槽<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>具名插槽其实就是给插槽取个名字。一个子组件可以放多个插槽，而且可以放在不同的地方，而父组件填充内容时，可以根据这个名字把内容填充到对应插槽中</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;div&gt;
        &lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;
        &lt;slot&gt;&lt;/slot&gt;
 
        &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;
    &lt;/div&gt;
</code></pre></div><p>父组件使用需对应名称</p> <div class="language- extra-class"><pre class="language-text"><code>        &lt;Dialog&gt;
            &lt;template v-slot:header&gt;
               &lt;div&gt;1&lt;/div&gt;
           &lt;/template&gt;
           &lt;template v-slot&gt;
               &lt;div&gt;2&lt;/div&gt;
           &lt;/template&gt;
           &lt;template v-slot:footer&gt;
               &lt;div&gt;3&lt;/div&gt;
           &lt;/template&gt;
        &lt;/Dialog&gt;
</code></pre></div><p>插槽简写</p> <div class="language- extra-class"><pre class="language-text"><code>        &lt;Dialog&gt;
            &lt;template #header&gt;
               &lt;div&gt;1&lt;/div&gt;
           &lt;/template&gt;
           &lt;template #default&gt;
               &lt;div&gt;2&lt;/div&gt;
           &lt;/template&gt;
           &lt;template #footer&gt;
               &lt;div&gt;3&lt;/div&gt;
           &lt;/template&gt;
        &lt;/Dialog&gt;
</code></pre></div><h3 id="作用域插槽"><a href="#作用域插槽" class="header-anchor">#</a> 作用域插槽</h3> <p>在子组件<a href="https://so.csdn.net/so/search?q=%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">动态绑定<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>参数 派发给父组件的slot去使用</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;div&gt;
        &lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;
        &lt;div&gt;
            &lt;div v-for=&quot;item in 100&quot;&gt;
                &lt;slot :data=&quot;item&quot;&gt;&lt;/slot&gt;
            &lt;/div&gt;
        &lt;/div&gt;
 
        &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;
    &lt;/div&gt;
</code></pre></div><p>通过结构方式取值</p> <div class="language- extra-class"><pre class="language-text"><code>         &lt;Dialog&gt;
            &lt;template #header&gt;
                &lt;div&gt;1&lt;/div&gt;
            &lt;/template&gt;
            &lt;template #default=&quot;{ data }&quot;&gt;
                &lt;div&gt;{{ data }}&lt;/div&gt;
            &lt;/template&gt;
            &lt;template #footer&gt;
                &lt;div&gt;3&lt;/div&gt;
            &lt;/template&gt;
        &lt;/Dialog&gt;
</code></pre></div><h3 id="动态插槽"><a href="#动态插槽" class="header-anchor">#</a> 动态插槽</h3> <p>插槽可以是一个变量名</p> <div class="language- extra-class"><pre class="language-text"><code>        &lt;Dialog&gt;
            &lt;template #[name]&gt;
                &lt;div&gt;
                    23
                &lt;/div&gt;
            &lt;/template&gt;
        &lt;/Dialog&gt;
        
        
        const name = ref('header')
</code></pre></div><h3 id="从子组件暴露插槽"><a href="#从子组件暴露插槽" class="header-anchor">#</a> 从子组件暴露插槽</h3> <p>有时，我们使用第三方组件时，会把它的实现包装在我们自定义组件中。这是一个很好的做法和可扩展的解决方案，但这样一来，第三方组件的插槽就会丢失，下面方法可以将它们的插槽暴露在父组件中：</p> <p><strong>WrapperComponent.vue</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
  &lt;div class=&quot;wrapper-of-third-party-component&quot;&gt;
    &lt;ThirdPartyComponent v-bind=&quot;$attrs&quot;&gt;

        &lt;!-- 暴露第三方组件的插槽  --&gt;
        &lt;template v-for=&quot;(_, name) in $slots&quot; #[name]=&quot;slotData&quot;&gt;
            &lt;slot :name=&quot;name&quot; v-bind=&quot;slotData || {}&quot;&gt;&lt;/slot&gt;
        &lt;/template&gt;

    &lt;/ThirdPartyComponent&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre></div><p>现在每个使用<code>WrapperComponent</code>的组件都可以使用第三方组件的插槽。</p> <h2 id="异步组件-代码分包-suspense"><a href="#异步组件-代码分包-suspense" class="header-anchor">#</a> 异步组件&amp;代码分包&amp;suspense</h2> <h3 id="异步组件"><a href="#异步组件" class="header-anchor">#</a> 异步组件</h3> <p>在大型应用中，我们可能需要将应用分割成小一些的代码块 并且减少主包的体积</p> <p>这时候就可以使用异步组件</p> <p><strong>顶层 <code>await</code></strong></p> <p>在setup语法糖里面 使用方法</p> <p><code>&lt;script setup&gt; 中可以使用顶层 await。结果代码会被编译成 async setup()</code></p> <div class="language- extra-class"><pre class="language-text"><code>&lt;script setup&gt;
const post = await fetch(`/api/post/1`).then(r =&gt; r.json())
&lt;/script&gt;
</code></pre></div><p>父组件引用子组件 通过defineAsyncComponent加载异步配合import 函数模式便可以分包</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
import { reactive, ref, markRaw, toRaw, defineAsyncComponent } from 'vue'
 
const Dialog = defineAsyncComponent(() =&gt; import('../../components/Dialog/index.vue'))
 
//完整写法
const AsyncComp = defineAsyncComponent({
  // 加载函数
  loader: () =&gt; import('./Foo.vue'),
 
  // 加载异步组件时使用的组件
  loadingComponent: LoadingComponent,
  // 展示加载组件前的延迟时间，默认为 200ms
  delay: 200,
 
  // 加载失败后展示的组件
  errorComponent: ErrorComponent,
  // 如果提供了一个 timeout 时间限制，并超时了
  // 也会显示这里配置的报错组件，默认值是：Infinity
  timeout: 3000
})
</code></pre></div><h3 id="suspense"><a href="#suspense" class="header-anchor">#</a> suspense</h3> <p><code>&lt;suspense&gt;</code> 组件有两个插槽。它们都只接收一个直接子节点。<code>default</code> 插槽里的节点会尽可能展示出来。如果不能，则展示 <code>fallback</code> 插槽里的节点。</p> <div class="language- extra-class"><pre class="language-text"><code>     &lt;Suspense&gt;
            &lt;template #default&gt;
                &lt;Dialog&gt;
                    &lt;template #default&gt;
                        &lt;div&gt;我在哪儿&lt;/div&gt;
                    &lt;/template&gt;
                &lt;/Dialog&gt;
            &lt;/template&gt;
 
            &lt;template #fallback&gt;
                &lt;div&gt;loading...&lt;/div&gt;
            &lt;/template&gt;
        &lt;/Suspense&gt;
</code></pre></div><h2 id="teleport传送组件"><a href="#teleport传送组件" class="header-anchor">#</a> Teleport传送组件</h2> <p>Teleport 是一种能够将我们的模板渲染至指定DOM节点，不受父级style、v-show等属性影响，但data、prop数据依旧能够共用的技术；</p> <p>主要解决的问题 因为Teleport节点挂载在其他指定的DOM节点下，完全不受父级style样式影响</p> <p>使用方法</p> <p>通过to 属性 插入指定元素位置 to=&quot;body&quot; 便可以将<code>Teleport</code> 内容传送到指定位置</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;Teleport to=&quot;body&quot;&gt;
    &lt;Loading&gt;&lt;/Loading&gt;
&lt;/Teleport&gt;
</code></pre></div><p>也可以自定义传送位置 支持 class id等 选择器</p> <p>多个使用场景</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;Teleport to=&quot;.modal1&quot;&gt;
     &lt;Loading&gt;&lt;/Loading&gt;
&lt;/Teleport&gt;
&lt;Teleport to=&quot;.modal2&quot;&gt;
     &lt;Loading&gt;&lt;/Loading&gt;
&lt;/Teleport&gt;
</code></pre></div><p>动态控制teleport</p> <p>使用disabled 设置为 true则 to属性不生效 false 则生效</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;teleport :disabled=&quot;true&quot; to='body'&gt;
      &lt;A&gt;&lt;/A&gt;
    &lt;/teleport&gt;
</code></pre></div><h2 id="keep-alive缓存组件"><a href="#keep-alive缓存组件" class="header-anchor">#</a> keep-alive缓存组件</h2> <p>有时候我们不希望组件被重新渲染影响使用体验；或者处于性能考虑，避免多次重复渲染降低性能。而是希望组件可以缓存下来,维持当前的状态。这时候就需要用到<code>keep-alive</code>组件。</p> <p>开启keep-alive 生命周期的变化</p> <p>初次进入时： onMounted&gt; onActivated
退出后触发 deactivated
再次进入：
只会触发 onActivated
事件挂载的方法等，只执行一次的放在 onMounted中；组件每次进去执行的方法放在 onActivated中</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- 基本 --&gt;
&lt;keep-alive&gt;
  &lt;component :is=&quot;view&quot;&gt;&lt;/component&gt;
&lt;/keep-alive&gt;
 
&lt;!-- 多个条件判断的子组件 --&gt;
&lt;keep-alive&gt;
  &lt;comp-a v-if=&quot;a &gt; 1&quot;&gt;&lt;/comp-a&gt;
  &lt;comp-b v-else&gt;&lt;/comp-b&gt;
&lt;/keep-alive&gt;
 
&lt;!-- 和 `&lt;transition&gt;` 一起使用 --&gt;
&lt;transition&gt;
  &lt;keep-alive&gt;
    &lt;component :is=&quot;view&quot;&gt;&lt;/component&gt;
  &lt;/keep-alive&gt;
&lt;/transition&gt;
</code></pre></div><p><strong><code>include</code> 和 <code>exclude</code></strong></p> <p><code>&lt;keep-alive :include=&quot;&quot; :exclude=&quot;&quot; :max=&quot;&quot;&gt;&lt;/keep-alive&gt;</code></p> <p>include 和 exclude 允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示：</p> <p><strong><code>max</code></strong></p> <p><code>&lt;keep-alive :max=&quot;10&quot;&gt; &lt;component :is=&quot;view&quot;&gt;&lt;/component&gt; &lt;/keep-alive&gt;</code></p> <h2 id="transition动画组件"><a href="#transition动画组件" class="header-anchor">#</a> transition动画组件</h2> <p>Vue 提供了 transition 的封装组件，在下列情形中，可以给任何元素和组件添加进入/离开过渡:</p> <ul><li>条件渲染 (使用 v-if)</li> <li>条件展示 (使用 v-show)</li> <li>动态组件</li> <li>组件根节点</li></ul> <p>自定义 transition 过度效果，你需要对<code>transition</code>组件的<code>name</code>属性自定义。并在css中写入对应的样式</p> <h3 id="过渡的类名"><a href="#过渡的类名" class="header-anchor">#</a> 过渡的类名</h3> <p>在进入/离开的过渡中，会有 6 个 class 切换。</p> <p>过渡 class   在进入/离开的过渡中，会有 6 个 class 切换。</p> <p>v-enter-from：定义进入过渡的开始状态。在元素被插入之前生效，在元素被插入之后的下一帧移除。</p> <p>v-enter-active：定义进入过渡生效时的状态。在整个进入过渡的阶段中应用，在元素被插入之前生效，在过渡/动画完成之后移除。这个类可以被用来定义进入过渡的过程时间，延迟和曲线函数。</p> <p>v-enter-to：定义进入过渡的结束状态。在元素被插入之后下一帧生效 (与此同时 v-enter-from 被移除)，在过渡/动画完成之后移除。</p> <p>v-leave-from：定义离开过渡的开始状态。在离开过渡被触发时立刻生效，下一帧被移除。</p> <p>v-leave-active：定义离开过渡生效时的状态。在整个离开过渡的阶段中应用，在离开过渡被触发时立刻生效，在过渡/动画完成之后移除。这个类可以被用来定义离开过渡的过程时间，延迟和曲线函数。</p> <p>v-leave-to：离开过渡的结束状态。在离开过渡被触发之后下一帧生效 (与此同时 v-leave-from 被移除)，在过渡/动画完成之后移除。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;button @click='flag = !flag'&gt;切换&lt;/button&gt;
&lt;transition name='fade'&gt;
	&lt;div v-if='flag' class=&quot;box&quot;&gt;&lt;/div&gt;
&lt;/transition&gt;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>//开始过度
.fade-enter-from{
   background:red;
   width:0px;
   height:0px;
   transform:rotate(360deg)
}
//开始过度了
.fade-enter-active{
  transition: all 2.5s linear;
}
//过度完成
.fade-enter-to{
   background:yellow;
   width:200px;
   height:200px;
}
//离开的过度
.fade-leave-from{
  width:200px;
  height:200px;
  transform:rotate(360deg)
}
//离开中过度
.fade-leave-active{
  transition: all 1s linear;
}
//离开完成
.fade-leave-to{
  width:0px;
   height:0px;
}
</code></pre></div><h3 id="自定义过渡-class-类名"><a href="#自定义过渡-class-类名" class="header-anchor">#</a> 自定义过渡 class 类名</h3> <p>transition props</p> <ul><li><code>enter-from-class</code></li> <li><code>enter-active-class</code></li> <li><code>enter-to-class</code></li> <li><code>leave-from-class</code></li> <li><code>leave-active-class</code></li> <li><code>leave-to-class</code></li></ul> <p>自定义过度时间 单位毫秒</p> <p>你也可以分别指定进入和离开的持续时间：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;transition :duration=&quot;1000&quot;&gt;...&lt;/transition&gt;
 
&lt;transition :duration=&quot;{ enter: 500, leave: 800 }&quot;&gt;...&lt;/transition&gt;
</code></pre></div><p>自定义class</p> <div class="language- extra-class"><pre class="language-text"><code>        &lt;transition
            leave-active-class=&quot;animate__animated animate__bounceInLeft&quot;
            enter-active-class=&quot;animate__animated animate__bounceInRight&quot;
        &gt;
            &lt;div v-if=&quot;flag&quot; class=&quot;box&quot;&gt;&lt;/div&gt;
        &lt;/transition&gt;
</code></pre></div><h3 id="transition-生命周期8个"><a href="#transition-生命周期8个" class="header-anchor">#</a> transition 生命周期8个</h3> <div class="language- extra-class"><pre class="language-text"><code>  @before-enter=&quot;beforeEnter&quot; //对应enter-from
  @enter=&quot;enter&quot;//对应enter-active
  @after-enter=&quot;afterEnter&quot;//对应enter-to
  @enter-cancelled=&quot;enterCancelled&quot;//显示过度打断
  @before-leave=&quot;beforeLeave&quot;//对应leave-from
  @leave=&quot;leave&quot;//对应enter-active
  @after-leave=&quot;afterLeave&quot;//对应leave-to
  @leave-cancelled=&quot;leaveCancelled&quot;//离开过度打断
</code></pre></div><p>当只用 JavaScript 过渡的时候，在 <strong><code>enter</code> 和 <code>leave</code> 钩子中必须使用 <code>done</code> 进行回调</strong></p> <div class="language- extra-class"><pre class="language-text"><code>const beforeEnter = (el: Element) =&gt; {
    console.log('进入之前from', el);
}
const Enter = (el: Element,done:Function) =&gt; {
    console.log('过度曲线');
    setTimeout(()=&gt;{
       done()
    },3000)
}
const AfterEnter = (el: Element) =&gt; {
    console.log('to');
}
</code></pre></div><h3 id="appear"><a href="#appear" class="header-anchor">#</a> appear</h3> <p>通过这个属性可以设置初始节点过度 就是页面加载完成就开始动画 对应三个状态</p> <div class="language- extra-class"><pre class="language-text"><code>appear-active-class=&quot;&quot;
appear-from-class=&quot;&quot;
appear-to-class=&quot;&quot;
appear
</code></pre></div><h2 id="transition-group过度列表"><a href="#transition-group过度列表" class="header-anchor">#</a> transition-group过度列表</h2> <p>怎么同时渲染整个列表，比如使用 <code>v-for</code>？在这种场景下，我们会使用 <code>&lt;transition-group&gt;</code> 组件。</p> <ul><li>默认情况下，它不会渲染一个包裹元素，但是你可以通过 <code>tag</code> attribute 指定渲染一个元素。</li> <li><a href="https://v3.cn.vuejs.org/guide/transitions-enterleave.html#%E8%BF%87%E6%B8%A1%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener noreferrer">过渡模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>不可用，因为我们不再相互切换特有的元素。</li> <li>内部元素<strong>总是需要</strong>提供唯一的 <code>key</code> attribute 值。</li> <li>CSS 过渡的类将会应用在内部的元素中，而不是这个组/容器本身。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;transition-group&gt;
     &lt;div style=&quot;margin: 10px;&quot; :key=&quot;item&quot; v-for=&quot;item in list&quot;&gt;{{ item }}&lt;/div&gt;
&lt;/transition-group&gt;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>const list = reactive&lt;number[]&gt;([1, 2, 4, 5, 6, 7, 8, 9])
const Push = () =&gt; {
    list.push(123)
}
const Pop = () =&gt; {
    list.pop()
}
</code></pre></div><h3 id="列表的移动过渡"><a href="#列表的移动过渡" class="header-anchor">#</a> 列表的移动过渡</h3> <p><code>&lt;transition-group&gt;</code> 组件还有一个特殊之处。除了进入和离开，它还可以为定位的改变添加动画。只需了解新增的 v-move 类就可以使用这个新功能，它会应用在元素改变定位的过程中。像之前的类名一样，它的前缀可以通过 name attribute 来自定义，也可以通过 move-class attribute 手动设置</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shuffle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wraps<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mmm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ul<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cell<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in items<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.number }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span>  <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token function">Array</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">81</span> <span class="token punctuation">}</span> <span class="token keyword">as</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> index<span class="token punctuation">,</span>
        <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token punctuation">(</span>index <span class="token operator">%</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">shuffle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    items<span class="token punctuation">.</span>value <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.wraps</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>25px * 10 + 9px<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token selector">.cell</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
        <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token selector">.mmm-move</span> <span class="token punctuation">{</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> transform 0.8s ease<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="状态过渡"><a href="#状态过渡" class="header-anchor">#</a> 状态过渡</h3> <p>Vue 也同样可以给字体 背景颜色等添加过渡动画</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
    &lt;div&gt;
        &lt;input step=&quot;20&quot; v-model=&quot;num.current&quot; type=&quot;number&quot; /&gt;
        &lt;div&gt;{{ num.tweenedNumber.toFixed(0) }}&lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;
    
&lt;script setup lang='ts'&gt;
import { reactive, watch } from 'vue'
import gsap from 'gsap'
const num = reactive({
    tweenedNumber: 0,
    current:0
})
 
watch(()=&gt;num.current, (newVal) =&gt; {
    gsap.to(num, {
        duration: 1,
        tweenedNumber: newVal
    })
})
 
&lt;/script&gt;
    
&lt;style&gt;
&lt;/style&gt;
</code></pre></div><h2 id="深入v-model"><a href="#深入v-model" class="header-anchor">#</a> 深入v-model</h2> <p>v-model 其实是一个语法糖 通过props 和 emit组合而成的</p> <p>1.默认值的改变</p> <ul><li>prop：<code>value</code> -&gt; <code>modelValue</code>；</li> <li>事件：<code>input</code> -&gt; <code>update:modelValue</code>；</li> <li><code>v-bind</code> 的 <code>.sync</code> 修饰符和组件的 <code>model</code> 选项已移除</li> <li>新增 支持多个v-model</li> <li>新增 支持自定义 修饰符 Modifiers</li></ul> <p>父组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show = !show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>开关{{show}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Dialog</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Dialog</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> Dialog <span class="token keyword">from</span> <span class="token string">&quot;./components/Dialog/index.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>子组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>propData.modelValue<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>close<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            内容
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
 
type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">modelValue</span><span class="token operator">:</span>boolean
<span class="token punctuation">}</span>
<span class="token keyword">const</span> propData <span class="token operator">=</span> defineProps<span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'update:modelValue'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>less<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.dialog</span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span>50%<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span>50%<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token selector">&amp;-header</span><span class="token punctuation">{</span>
        <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;-content</span><span class="token punctuation">{</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="绑定多个案例"><a href="#绑定多个案例" class="header-anchor">#</a> 绑定多个案例</h3> <p>父组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show = !show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>开关{{show}} ----- {{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Dialog</span> <span class="token attr-name"><span class="token namespace">v-model:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>title<span class="token punctuation">'</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Dialog</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> Dialog <span class="token keyword">from</span> <span class="token string">&quot;./components/Dialog/index.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'我是标题'</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>子组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>modelValue <span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>标题---{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>close<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            内容
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
         
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
 
type Props <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">modelValue</span><span class="token operator">:</span>boolean<span class="token punctuation">,</span>
   <span class="token literal-property property">title</span><span class="token operator">:</span>string
<span class="token punctuation">}</span>
 
<span class="token keyword">const</span> propData <span class="token operator">=</span> defineProps<span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span><span class="token string">'update:title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
<span class="token keyword">const</span> <span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span>
     <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:title'</span><span class="token punctuation">,</span><span class="token string">'我要改变'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
 
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>less<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.dialog</span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span>50%<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span>50%<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token selector">&amp;-header</span><span class="token punctuation">{</span>
        <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;-content</span><span class="token punctuation">{</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="自定义修饰符"><a href="#自定义修饰符" class="header-anchor">#</a> 自定义修饰符</h3> <p>添加到组件 <code>v-model</code> 的修饰符将通过 <code>modelModifiers</code> prop 提供给组件。在下面的示例中，我们创建了一个组件，其中包含默认为空对象的 <code>modelModifiers</code> prop</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
 
type Props = {
    modelValue: boolean,
    title?: string,
    modelModifiers?: {
        default: () =&gt; {}
    }
    titleModifiers?: {
        default: () =&gt; {}
    }
 
}
 
const propData = defineProps<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Props</span><span class="token punctuation">&gt;</span></span>()
 
const emit = defineEmits(['update:modelValue', 'update:title'])
 
const close = () =&gt; {
    console.log(propData.modelModifiers);
 
    emit('update:modelValue', false)
    emit('update:title', '我要改变')
}
</code></pre></div><h2 id="自定义指令directive-属于破坏性更新"><a href="#自定义指令directive-属于破坏性更新" class="header-anchor">#</a> 自定义指令directive(属于破坏性更新)</h2> <p>directive-<a href="https://so.csdn.net/so/search?q=%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">自定义指令<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（属于破坏性更新）</p> <h3 id="vue3指令的钩子函数"><a href="#vue3指令的钩子函数" class="header-anchor">#</a> vue3指令的钩子函数</h3> <p>created 元素初始化的时候
beforeMount 指令绑定到元素后调用 只调用一次
mounted 元素插入父级dom调用
beforeUpdate 元素被更新之前调用
update 这个周期方法被移除 改用updated
beforeUnmount 在元素被移除前调用
unmounted 指令被移除后调用 只调用一次</p> <p>Vue2 指令 bind inserted update componentUpdated unbind</p> <h3 id="在setup内定义局部指令"><a href="#在setup内定义局部指令" class="header-anchor">#</a> 在setup内定义局部指令</h3> <p>这里有一个需要注意的限制：必须以 <code>vNameOfDirective</code> 的形式来命名本地自定义指令，以使得它们可以直接在模板中使用。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show = !show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>开关{{show}} ----- {{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Dialog</span>  <span class="token attr-name">v-move-directive</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{background:'green',flag:show}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Dialog</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code> 
<span class="token keyword">const</span> <span class="token literal-property property">vMoveDirective</span><span class="token operator">:</span> Directive <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;初始化====&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在元素上做些操作</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;初始化一次=======&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">dir</span><span class="token operator">:</span> DirectiveBinding<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> dir<span class="token punctuation">.</span>value<span class="token punctuation">.</span>background<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;初始化========&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;更新之前&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;更新结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeUnmount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;======&gt;卸载之前&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">unmounted</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;======&gt;卸载完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="生命周期钩子参数详解"><a href="#生命周期钩子参数详解" class="header-anchor">#</a> 生命周期钩子参数详解</h3> <p>第一个 el 当前绑定的DOM 元素</p> <p>第二个 binding</p> <p>instance：使用指令的组件实例。
value：传递给指令的值。例如，在 v-my-directive=&quot;1 + 1&quot; 中，该值为 2。
oldValue：先前的值，仅在 beforeUpdate 和 updated 中可用。无论值是否有更改都可用。
arg：传递给指令的参数(如果有的话)。例如在 v-my-directive:foo 中，arg 为 &quot;foo&quot;。
modifiers：包含修饰符(如果有的话) 的对象。例如在 v-my-directive.foo.bar 中，修饰符对象为 {foo: true，bar: true}。
dir：一个对象，在注册指令时作为参数传递。</p> <p>第三个 当前元素的虚拟DOM 也就是Vnode</p> <p>第四个 prevNode 上一个虚拟节点，仅在 <code>beforeUpdate</code> 和 <code>updated</code> 钩子中可用</p> <h3 id="函数简写"><a href="#函数简写" class="header-anchor">#</a> 函数简写</h3> <p>你可能想在 <code>mounted</code> 和 <code>updated</code> 时触发相同行为，而不关心其他的钩子函数。那么你可以通过将这个函数模式实现</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>A</span> <span class="token attr-name">v-move</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ background: value }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>A</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">'./components/A.vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> Directive<span class="token punctuation">,</span> DirectiveBinding <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
type Dir <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">background</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token literal-property property">vMove</span><span class="token operator">:</span> <span class="token function-variable function">Directive</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> <span class="token literal-property property">binding</span><span class="token operator">:</span> DirectiveBinding<span class="token operator">&lt;</span>Dir<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">.</span>background
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>自定义拖拽指令</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-move</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      内容
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Directive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token literal-property property">vMove</span><span class="token operator">:</span> Directive <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> HTMLElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> moveEl <span class="token operator">=</span> el<span class="token punctuation">.</span>firstElementChild <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">mouseDown</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> MouseEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//鼠标点击物体那一刻相对于物体左侧边框的距离=点击时的位置相对于浏览器最左边的距离-物体左边框相对于浏览器最左边的距离</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span> <span class="token string">&quot;-----起始&quot;</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> <span class="token constant">X</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> el<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>
      <span class="token keyword">let</span> <span class="token constant">Y</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> el<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token function-variable function">move</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> MouseEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token constant">X</span> <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token constant">Y</span> <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span> <span class="token string">&quot;---改变&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> move<span class="token punctuation">)</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mouseup&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> move<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    moveEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousedown&quot;</span><span class="token punctuation">,</span> mouseDown<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>less<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.box</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
  <span class="token selector">.header</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> move<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="自定义hooks"><a href="#自定义hooks" class="header-anchor">#</a> 自定义Hooks</h2> <p>Vue3 自定义Hook</p> <p>主要用来处理复用代码逻辑的一些封装</p> <p>这个在vue2 就已经有一个东西是Mixins</p> <p>mixins就是将这些多个相同的逻辑抽离出来，各个组件只需要引入mixins，就能实现一次写代码，多组件受益的效果。</p> <p>弊端就是 会涉及到覆盖的问题</p> <p>组件的data、methods、filters会覆盖mixins里的同名data、methods、filters。</p> <p>第二点就是 变量来源不明确（隐式传入），不利于阅读，使代码变得难以维护。</p> <p>Vue3 的自定义的hook</p> <p>Vue3 的 hook函数 相当于 vue2 的 mixin, 不同在与 hooks 是函数
Vue3 的 hook函数 可以帮助我们提高代码的复用性, 让我们能在不同的组件中都利用 hooks 函数</p> <p>Vue3 hook 库<a href="https://vueuse.org/guide/" target="_blank" rel="noopener noreferrer">Get Started | VueUse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="vue3定义全局函数和变量"><a href="#vue3定义全局函数和变量" class="header-anchor">#</a> Vue3定义全局函数和变量</h2> <h3 id="globalproperties"><a href="#globalproperties" class="header-anchor">#</a> globalProperties</h3> <p>由于<a href="https://so.csdn.net/so/search?q=Vue3&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Vue3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 没有Prototype 属性 使用 app.config.globalProperties 代替 然后去定义变量和函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 之前 (Vue 2.x)</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$http</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 之后 (Vue 3.x)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span><span class="token function-variable function">$http</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="过滤器"><a href="#过滤器" class="header-anchor">#</a> 过滤器</h3> <p>在Vue3 移除了</p> <p>可以使用全局函数代替Filters</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$filters <span class="token operator">=</span> <span class="token punctuation">{</span>
  format<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>str<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>声明文件 不然TS无法正确类型 推导</p> <div class="language-js extra-class"><pre class="language-js"><code>type Filter <span class="token operator">=</span> <span class="token punctuation">{</span>
    format<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>str<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
 
<span class="token comment">// 声明要扩充@vue/runtime-core包的声明.</span>
<span class="token comment">// 这里扩充&quot;ComponentCustomProperties&quot;接口, 因为他是vue3中实例的属性的类型.</span>
declare module <span class="token string">'vue'</span> <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ComponentCustomProperties</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">$filters</span><span class="token operator">:</span> Filter
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>setup 读取值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance<span class="token punctuation">,</span> ComponentInternalInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> <span class="token punctuation">{</span> appContext <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token operator">&lt;</span>ComponentInternalInstance<span class="token operator">&gt;</span><span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$env<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
推荐第二种方式
 
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">,</span>getCurrentInstance<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$filters<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="编写vue3插件"><a href="#编写vue3插件" class="header-anchor">#</a> 编写Vue3插件</h2> <p>插件是自包含的代码，通常向 Vue 添加全局级功能。你如果是一个对象需要有install方法Vue会帮你自动注入到install 方法 你如果是function 就直接当install 方法去使用</p> <p>在使用 <code>createApp()</code> 初始化 Vue 应用程序后，你可以通过调用 <code>use()</code> 方法将插件添加到你的应用程序中。</p> <p>实现一个Loading</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// Loading.Vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isShow <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token comment">//定位loading 的开关</span>
 
<span class="token keyword">const</span> <span class="token function-variable function">show</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    isShow<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">hide</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    isShow<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
<span class="token comment">//对外暴露 当前组件的属性和方法</span>
<span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    isShow<span class="token punctuation">,</span>
    show<span class="token punctuation">,</span>
    hide
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.loading</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">inset</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token selector">&amp;-content</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Loading.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>  createVNode<span class="token punctuation">,</span> render<span class="token punctuation">,</span> VNode<span class="token punctuation">,</span> App <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">'./index.vue'</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">app</span><span class="token operator">:</span> App</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//createVNode vue提供的底层方法 可以给我们组件创建一个虚拟DOM 也就是Vnode</span>
        <span class="token keyword">const</span> <span class="token literal-property property">vnode</span><span class="token operator">:</span> VNode <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>Loading<span class="token punctuation">)</span>
        <span class="token comment">//render 把我们的Vnode 生成真实DOM 并且挂载到指定节点</span>
        <span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
        <span class="token comment">// Vue 提供的全局配置 可以自定义</span>
        app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$loading <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">show</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> vnode<span class="token punctuation">.</span>component<span class="token operator">?.</span>exposed<span class="token operator">?.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function-variable function">hide</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> vnode<span class="token punctuation">.</span>component<span class="token operator">?.</span>exposed<span class="token operator">?.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Main.ts</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">'./components/loading'</span>
 
<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Loading<span class="token punctuation">)</span>
type Lod <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">show</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
    <span class="token function-variable function">hide</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token comment">//编写ts loading 声明文件放置报错 和 智能提示</span>
declare module <span class="token string">'@vue/runtime-core'</span> <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ComponentCustomProperties</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">$loading</span><span class="token operator">:</span> Lod
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code>// 使用方法
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span>reactive<span class="token punctuation">,</span>getCurrentInstance<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span>  instance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Loading<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Loading<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span>
<span class="token comment">// console.log(instance)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">*</span><span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="vue-use-源码手写"><a href="#vue-use-源码手写" class="header-anchor">#</a> Vue use 源码手写</h3> <div class="language- extra-class"><pre class="language-text"><code>import type { App } from 'vue'
import { app } from './main'
 
interface Use {
    install: (app: App, ...options: any[]) =&gt; void
}
 
const installedList = new Set()
 
export function MyUse&lt;T extends Use&gt;(plugin: T, ...options: any[]) {
    if(installedList.has(plugin)){
      return console.warn('重复添加插件',plugin)
    }else{
        plugin.install(app, ...options)
        installedList.add(plugin)
    }
} 
</code></pre></div><h2 id="scoped和样式-穿透"><a href="#scoped和样式-穿透" class="header-anchor">#</a> Scoped和样式 穿透</h2> <p>主要是用于修改很多vue常用的组件库（element, <a href="https://so.csdn.net/so/search?q=vant&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">vant<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, AntDesigin），虽然配好了样式但是还是需要更改其他的样式</p> <p>就需要用到<a href="https://so.csdn.net/so/search?q=%E6%A0%B7%E5%BC%8F%E7%A9%BF%E9%80%8F&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">样式穿透<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://so.csdn.net/so/search?q=scoped&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">scoped<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的原理</p> <p>vue中的scoped 通过在DOM结构以及css样式上加唯一不重复的标记:data-v-hash的方式，以保证唯一（而这个工作是由过PostCSS转译实现的），达到样式私有化模块化的目的。</p> <p>总结一下scoped三条渲染规则：</p> <ol><li>给HTML的DOM节点加一个不重复data属性(形如：data-v-123)来表示他的唯一性</li> <li>在每句css选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如[data-v-123]）来私有化样式</li> <li>如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性（具有多个根节点的子组件不能从父范围的样式设置样式）</li></ol> <p>PostCSS会给一个组件中的所有dom添加了一个独一无二的动态属性data-v-xxxx，然后，给CSS选择器额外添加一个对应的属性选择器来选择该组件中dom，这种做法使得样式只作用于含有该属性的dom——组件内部dom, 从而达到了'样式模块化'的效果.</p> <p>Vue 提供了样式穿透:<strong>deep()</strong> 他的作用就是用来改变 属性选择器的位置</p> <h2 id="css-style完整新特性"><a href="#css-style完整新特性" class="header-anchor">#</a> css Style完整新特性</h2> <p>除了deep(),其实还有两个选择器可以补充</p> <h3 id="插槽选择器-slotted"><a href="#插槽选择器-slotted" class="header-anchor">#</a> 插槽选择器(slotted)</h3> <div class="language-vue extra-class"><pre class="language-vue"><code>// A组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        我是插槽
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
 <span class="token selector">:slotted(.a)</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span>red
 <span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code>// 父组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>A</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>私人定制div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>A</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">&quot;@/components/A.vue&quot;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="全局选择器"><a href="#全局选择器" class="header-anchor">#</a> 全局选择器</h3> <p>在之前我们想加入全局 样式 通常都是新建一个style 标签 不加<a href="https://so.csdn.net/so/search?q=scoped&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">scoped<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 现在有更优雅的解决方案</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">&lt;style&gt;
 div</span><span class="token punctuation">{</span>
     <span class="token property">color</span><span class="token punctuation">:</span>red
 <span class="token punctuation">}</span>
<span class="token selector">&lt;/style&gt;
 
//  效果等同于上面
&lt;style lang=&quot;less&quot; scoped&gt;
:global(div)</span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span>red
<span class="token punctuation">}</span>
&lt;/style&gt;
</code></pre></div><h3 id="动态-css"><a href="#动态-css" class="header-anchor">#</a> 动态 CSS</h3> <p>单文件组件的 <code>&lt;style&gt;</code> 标签可以通过 <code>v-bind</code> 这一 CSS 函数将 CSS 的值关联到动态的组件状态上：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       小满是个弟弟
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> red <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.div</span><span class="token punctuation">{</span>
   <span class="token property">color</span><span class="token punctuation">:</span><span class="token function">v-bind</span><span class="token punctuation">(</span>red<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
 
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果是对象 <a href="https://so.csdn.net/so/search?q=v-bind&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">v-bind<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ,加引号</p> <div class="language-vue extra-class"><pre class="language-vue"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        小满是个弟弟
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">const</span> red <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span><span class="token string">'pink'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.div</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span><span class="token string">'red.color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="mitt"><a href="#mitt" class="header-anchor">#</a> Mitt</h2> <p>在<a href="https://so.csdn.net/so/search?q=vue3&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">vue3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中$on，$off 和 $once 实例方法已被移除，组件实例不再实现事件触发接口，因此大家熟悉的EventBus便无法使用了。然而我们习惯了使用EventBus，对于这种情况我们可以使用Mitt库（其实就是我们视频中讲的发布订阅模式的设计）</p> <h3 id="main-ts-初始化"><a href="#main-ts-初始化" class="header-anchor">#</a> main.ts 初始化</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> mitt <span class="token keyword">from</span> <span class="token string">'mitt'</span>
 
<span class="token keyword">const</span> Mit <span class="token operator">=</span> <span class="token function">mitt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
<span class="token comment">//TypeScript注册</span>
<span class="token comment">// 由于必须要拓展ComponentCustomProperties类型才能获得类型提示</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&quot;vue&quot;</span> <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ComponentCustomProperties</span> <span class="token punctuation">{</span>
        $Bus<span class="token operator">:</span> <span class="token keyword">typeof</span> Mit
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
 
<span class="token comment">//Vue3挂载全局API</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$Bus <span class="token operator">=</span> Mit
 
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="使用方法通过emit派发-on-方法添加事件-off-方法移除-clear-清空所有"><a href="#使用方法通过emit派发-on-方法添加事件-off-方法移除-clear-清空所有" class="header-anchor">#</a> 使用方法通过emit派发， on 方法添加事件，off 方法移除，clear 清空所有</h3> <div class="language-vue extra-class"><pre class="language-vue"><code>// A组件派发（emit）
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>我是A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>emit1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>emit1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>emit2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>emit2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">emit1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'on-num'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">emit2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'*****'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code>B组件监听（on）
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>我是B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'on-num'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span><span class="token string">'===========&gt;B'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="监听所有事件-on"><a href="#监听所有事件-on" class="header-anchor">#</a> 监听所有事件（ on(&quot;*&quot;) ）</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code>instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span>num<span class="token punctuation">,</span><span class="token string">'===========&gt;B'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="移除监听事件-off"><a href="#移除监听事件-off" class="header-anchor">#</a> 移除监听事件（off）</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">Fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token string">'===========&gt;B'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'on-num'</span><span class="token punctuation">,</span>Fn<span class="token punctuation">)</span><span class="token comment">//listen</span>
instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Bus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'on-num'</span><span class="token punctuation">,</span>Fn<span class="token punctuation">)</span><span class="token comment">//unListen</span>
</code></pre></div><h3 id="清空所有监听-clear"><a href="#清空所有监听-clear" class="header-anchor">#</a> 清空所有监听（clear）</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code>instance<span class="token operator">?.</span>proxy<span class="token operator">?.</span>$Bus<span class="token punctuation">.</span>all<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre></div><h2 id="环境变量"><a href="#环境变量" class="header-anchor">#</a> 环境变量</h2> <p><strong>他的主要作用就是让开发者区分不同的运行环境，来实现 兼容开发和生产</strong></p> <p><strong>例如 npm run dev 就是开发环境 npm run build 就是生产环境等等</strong></p> <p><a href="https://so.csdn.net/so/search?q=Vite&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Vite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 在一个特殊的 <strong><code>import.meta.env</code></strong> 对象上暴露环境变量。这里有一些在所有情况下都可以使用的内建变量</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;BASE_URL&quot;</span><span class="token operator">:</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token comment">//部署时的URL前缀</span>
    <span class="token property">&quot;MODE&quot;</span><span class="token operator">:</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//运行模式</span>
    <span class="token property">&quot;DEV&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>&quot;  <span class="token comment">//是否在dev环境</span>
    PROD&quot;<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否是build 环境</span>
    <span class="token property">&quot;SSR&quot;</span><span class="token operator">:</span><span class="token boolean">false</span> <span class="token comment">//是否是SSR 服务端渲染模式</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>需要注意的一点就是这个环境变量不能使用动态赋值import.meta.env[key] 因为这些环境变量在打包的时候是会被硬编码的通过JSON.stringify 注入浏览器的</strong></p> <h3 id="配置额外的环境变量"><a href="#配置额外的环境变量" class="header-anchor">#</a> 配置额外的环境变量</h3> <p>在根目录新建env 文件 可以创建多个</p> <p>格式：.env.development</p> <p>修改启动命令</p> <p>在 package json 配置 --mode env文件名称()</p> <p>配置智能提示:env.d.ts</p> <div class="language- extra-class"><pre class="language-text"><code>interface ImportMetaEnv {
    VITE_XIAOMAN:string
}
</code></pre></div><p>读取环境变量属性值</p> <p>import.meta.env.VITE_XIAOMAN</p> <h3 id="生产环境使用"><a href="#生产环境使用" class="header-anchor">#</a> 生产环境使用</h3> <p>创建 .env.production 在执行npm run build 的时候他会自己加载这个文件</p> <h3 id="如果想在vite-config-ts-使用环境变量"><a href="#如果想在vite-config-ts-使用环境变量" class="header-anchor">#</a> <strong>如果想在vite.config.ts 使用环境变量</strong></h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fileURLToPath<span class="token punctuation">,</span> <span class="token constant">URL</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'node:url'</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig<span class="token punctuation">,</span> loadEnv <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span>
<span class="token keyword">import</span> vueJsx <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue-jsx'</span>
 
 
 
<span class="token comment">// https://vitejs.dev/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>mode<span class="token punctuation">}</span><span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">vueJsx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
      alias<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'@'</span><span class="token operator">:</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token string">'./src'</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
</code></pre></div><h2 id="proxy跨域"><a href="#proxy跨域" class="header-anchor">#</a> Proxy跨域</h2> <h3 id="什么是跨域"><a href="#什么是跨域" class="header-anchor">#</a> 什么是<a href="https://so.csdn.net/so/search?q=%E8%B7%A8%E5%9F%9F&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">跨域<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>主要是出于浏览器的<a href="https://so.csdn.net/so/search?q=%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">同源策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>限制，它是浏览器最核心也最基本的安全功能。</p> <p>当一个请求url的 <strong>协议、域名、端口</strong> 三者之间任意一个与当前页面url不同即为跨域。</p> <h3 id="如何解决跨域"><a href="#如何解决跨域" class="header-anchor">#</a> 如何解决跨域</h3> <p>1.<a href="https://so.csdn.net/so/search?q=jsonp&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">jsonp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这种方式在之前很常见，他实现的基本原理是利用了HTML里script元素标签没有跨域限制 动态创建script标签，将src作为服务器地址，服务器返回一个callback接受返回的参数</p> <p>2.cors 设置 CORS 允许跨域资源共享 需要后端设置</p> <p>3.使用Vite proxy 或者 node代理 或者 webpack proxy 他们三种方式都是代理</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// node 后端接口</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
<span class="token comment">//创建get请求</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/xm'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&quot;请求成功&quot;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//端口号9001</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9001</span><span class="token punctuation">)</span>
</code></pre></div><p>在vite.config.js/ts 进行配置</p> <div class="language- extra-class"><pre class="language-text"><code>export default defineConfig({
  plugins: [vue()],
  server:{
     proxy:{
        '/api':{
            target:&quot;http://localhost:9001/&quot;, //跨域地址
            changeOrigin:true, //支持跨域
            rewrite:(path) =&gt; path.replace(/^\/api/, &quot;&quot;)//重写路径,替换/api
        }
     }
  }
})
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-blog/vue3+elementplus+ts+pinia踩坑记录.html" class="prev">
        vue3+elementplus+ts+pinia踩坑记录
      </a></span> <span class="next"><a href="/vuepress-blog/vuex.html">
        vuex
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.a8afb511.js" defer></script><script src="/vuepress-blog/assets/js/2.eeb24f79.js" defer></script><script src="/vuepress-blog/assets/js/25.c49860b4.js" defer></script>
  </body>
</html>
